import pytest  # type: ignore
from indicators import (
    detect_order_blocks,
    detect_fvgs,
    detect_liquidity_levels,
    detect_breaker_blocks,
)
from IndicatorUtils.breaker_block_utils import BreakerBlocks
from IndicatorUtils.fvg_utils import FVGs
from IndicatorUtils.liquidity_level_utils import LiquidityLevels
from IndicatorUtils.order_block_utils import OrderBlocks

from data_fetching_instruments import fetch_from_json


@pytest.fixture
def setup_data():
    """Fixture to provide test data."""
    args = {
        "retCode": 0,
        "retMsg": "OK",
        "result": {
            "category": "spot",
            "symbol": "BTCUSDT",
            "list": [
                [
                    "1735435800000",
                    "95012.99",
                    "95040.55",
                    "94984.65",
                    "95004.65",
                    "58.386439",
                    "5547646.07313394",
                ],
                [
                    "1735434000000",
                    "95153.49",
                    "95220.47",
                    "94881.55",
                    "95012.99",
                    "368.723781",
                    "35039731.21205676",
                ],
                [
                    "1735432200000",
                    "95140.74",
                    "95237.67",
                    "95045.3",
                    "95153.49",
                    "439.537224",
                    "41815412.75453579",
                ],
                [
                    "1735430400000",
                    "95298.41",
                    "95342.7",
                    "95135.7",
                    "95140.74",
                    "525.830594",
                    "50058374.5493207",
                ],
                [
                    "1735428600000",
                    "95322.87",
                    "95424.29",
                    "95168.91",
                    "95298.41",
                    "293.634107",
                    "27986240.0986246",
                ],
                [
                    "1735426800000",
                    "95322.14",
                    "95407.12",
                    "95112.76",
                    "95322.87",
                    "397.25138",
                    "37845502.0803557",
                ],
                [
                    "1735425000000",
                    "95250.37",
                    "95738.6",
                    "95059.44",
                    "95322.14",
                    "273.752527",
                    "26095570.45168412",
                ],
                [
                    "1735423200000",
                    "95164.25",
                    "95466",
                    "95046",
                    "95250.37",
                    "184.019768",
                    "17516527.09690935",
                ],
                [
                    "1735421400000",
                    "95039.12",
                    "95223.2",
                    "94977.19",
                    "95164.25",
                    "153.199446",
                    "14571970.46285247",
                ],
                [
                    "1735419600000",
                    "95091.46",
                    "95094.52",
                    "94958.87",
                    "95039.12",
                    "181.554289",
                    "17253076.34746266",
                ],
                [
                    "1735417800000",
                    "94885.06",
                    "95162.46",
                    "94875.15",
                    "95091.46",
                    "173.882081",
                    "16521352.68871295",
                ],
                [
                    "1735416000000",
                    "95033.35",
                    "95078.34",
                    "94879.41",
                    "94885.06",
                    "259.50588",
                    "24641508.59371351",
                ],
                [
                    "1735414200000",
                    "95021.54",
                    "95152.7",
                    "94976.04",
                    "95033.35",
                    "218.049306",
                    "20730255.72457815",
                ],
                [
                    "1735412400000",
                    "94843.6",
                    "95105.1",
                    "94836.44",
                    "95021.54",
                    "227.791085",
                    "21635744.70029243",
                ],
                [
                    "1735410600000",
                    "94975.95",
                    "95005.31",
                    "94713.68",
                    "94843.6",
                    "235.170105",
                    "22309396.98066494",
                ],
                [
                    "1735408800000",
                    "95031.19",
                    "95112.38",
                    "94891.01",
                    "94975.95",
                    "322.002187",
                    "30589094.23773962",
                ],
                [
                    "1735407000000",
                    "95116.13",
                    "95228.47",
                    "94932.3",
                    "95031.19",
                    "406.853944",
                    "38689567.1894787",
                ],
                [
                    "1735405200000",
                    "94871",
                    "95252.21",
                    "94806",
                    "95116.13",
                    "514.014656",
                    "48857666.42994244",
                ],
                [
                    "1735403400000",
                    "94582.44",
                    "94932.12",
                    "94571.89",
                    "94871",
                    "452.444562",
                    "42867844.12682507",
                ],
                [
                    "1735401600000",
                    "94444.65",
                    "94630.5",
                    "94386.69",
                    "94582.44",
                    "399.231581",
                    "37726573.15067729",
                ],
                [
                    "1735399800000",
                    "94696.41",
                    "94809.24",
                    "94364.17",
                    "94444.65",
                    "329.236436",
                    "31133853.43220314",
                ],
                [
                    "1735398000000",
                    "94592.3",
                    "94825.1",
                    "94482.03",
                    "94696.41",
                    "494.612665",
                    "46822511.99278332",
                ],
                [
                    "1735396200000",
                    "94892.1",
                    "94973.16",
                    "94402.62",
                    "94592.3",
                    "479.596813",
                    "45395171.52790273",
                ],
                [
                    "1735394400000",
                    "94659.18",
                    "95335.44",
                    "94575.14",
                    "94892.1",
                    "578.619616",
                    "54968029.11510722",
                ],
                [
                    "1735392600000",
                    "94684.48",
                    "94754.58",
                    "94495.72",
                    "94659.18",
                    "274.499833",
                    "25978389.92902834",
                ],
                [
                    "1735390800000",
                    "94591.89",
                    "94761.84",
                    "94510.63",
                    "94684.48",
                    "279.429559",
                    "26447557.2345394",
                ],
                [
                    "1735389000000",
                    "94660.7",
                    "94748.78",
                    "94589.98",
                    "94591.89",
                    "181.174811",
                    "17150979.24929988",
                ],
                [
                    "1735387200000",
                    "94752.09",
                    "94887.92",
                    "94626",
                    "94660.7",
                    "275.53659",
                    "26111642.32374498",
                ],
                [
                    "1735385400000",
                    "94740.6",
                    "94891.25",
                    "94647.65",
                    "94752.09",
                    "184.500781",
                    "17479781.29411506",
                ],
                [
                    "1735383600000",
                    "94624.61",
                    "94747.5",
                    "94592.49",
                    "94740.6",
                    "165.357753",
                    "15652810.49494421",
                ],
                [
                    "1735381800000",
                    "94677.63",
                    "94721",
                    "94566",
                    "94624.61",
                    "196.995636",
                    "18645472.05257118",
                ],
                [
                    "1735380000000",
                    "94576.75",
                    "94707.86",
                    "94489.4",
                    "94677.63",
                    "164.229262",
                    "15537929.88347933",
                ],
                [
                    "1735378200000",
                    "94583.66",
                    "94692.86",
                    "94566.59",
                    "94576.75",
                    "180.419994",
                    "17074038.03557995",
                ],
                [
                    "1735376400000",
                    "94485.78",
                    "94693.49",
                    "94474.96",
                    "94583.66",
                    "170.328347",
                    "16112748.56396872",
                ],
                [
                    "1735374600000",
                    "94399.97",
                    "94543.13",
                    "94371",
                    "94485.78",
                    "92.636411",
                    "8750982.45254667",
                ],
                [
                    "1735372800000",
                    "94371.72",
                    "94487.2",
                    "94301",
                    "94399.97",
                    "184.345583",
                    "17402662.49854195",
                ],
                [
                    "1735371000000",
                    "94563.58",
                    "94574.17",
                    "94291.93",
                    "94371.72",
                    "222.122941",
                    "20966108.70729419",
                ],
                [
                    "1735369200000",
                    "94469.97",
                    "94642.07",
                    "94469.02",
                    "94563.58",
                    "174.564503",
                    "16505795.39737886",
                ],
                [
                    "1735367400000",
                    "94541.78",
                    "94587.48",
                    "94399.41",
                    "94469.97",
                    "254.921192",
                    "24080415.4956662",
                ],
                [
                    "1735365600000",
                    "94623.42",
                    "94725.62",
                    "94505.3",
                    "94541.78",
                    "208.549063",
                    "19726184.63433749",
                ],
                [
                    "1735363800000",
                    "94674.49",
                    "94808.47",
                    "94603.21",
                    "94623.42",
                    "240.096764",
                    "22739849.2815696",
                ],
                [
                    "1735362000000",
                    "94515.82",
                    "94755.1",
                    "94515.82",
                    "94674.49",
                    "192.031548",
                    "18174017.35917633",
                ],
                [
                    "1735360200000",
                    "94592.68",
                    "94616.97",
                    "94503.29",
                    "94515.82",
                    "114.048251",
                    "10785322.61651266",
                ],
                [
                    "1735358400000",
                    "94584.53",
                    "94651.68",
                    "94494.75",
                    "94592.68",
                    "157.759433",
                    "14919799.95114",
                ],
                [
                    "1735356600000",
                    "94607.12",
                    "94717.41",
                    "94501.44",
                    "94584.53",
                    "172.595789",
                    "16329672.62814119",
                ],
                [
                    "1735354800000",
                    "94322.96",
                    "94617.03",
                    "94321.13",
                    "94607.12",
                    "235.275302",
                    "22234172.73894749",
                ],
                [
                    "1735353000000",
                    "94516.63",
                    "94603.55",
                    "94270.29",
                    "94322.96",
                    "277.714782",
                    "26226738.71782616",
                ],
                [
                    "1735351200000",
                    "94541",
                    "94622.66",
                    "94456.33",
                    "94516.63",
                    "288.647853",
                    "27290357.71610301",
                ],
                [
                    "1735349400000",
                    "94256.31",
                    "94622.79",
                    "94139.85",
                    "94541",
                    "373.446427",
                    "35265277.10758694",
                ],
                [
                    "1735347600000",
                    "94396.61",
                    "94441.91",
                    "94127.01",
                    "94256.31",
                    "390.089733",
                    "36778262.6559609",
                ],
                [
                    "1735345800000",
                    "94460.02",
                    "94500.99",
                    "94306.17",
                    "94396.61",
                    "472.596013",
                    "44606232.48629819",
                ],
                [
                    "1735344000000",
                    "94300.45",
                    "94538.19",
                    "94251.08",
                    "94460.02",
                    "476.939079",
                    "45023609.1037333",
                ],
                [
                    "1735342200000",
                    "94371.31",
                    "94519.22",
                    "94127.67",
                    "94300.45",
                    "297.759352",
                    "28087472.15273896",
                ],
                [
                    "1735340400000",
                    "94430.85",
                    "94535.5",
                    "94239.92",
                    "94371.31",
                    "307.98297",
                    "29073308.58385759",
                ],
                [
                    "1735338600000",
                    "94504.29",
                    "94676",
                    "94379.66",
                    "94430.85",
                    "124.968031",
                    "11810539.4444865",
                ],
                [
                    "1735336800000",
                    "94532.12",
                    "94641",
                    "94175.28",
                    "94504.29",
                    "244.637941",
                    "23087986.6314866",
                ],
                [
                    "1735335000000",
                    "94697.73",
                    "94759.2",
                    "94376.27",
                    "94532.12",
                    "353.566757",
                    "33432557.99824882",
                ],
                [
                    "1735333200000",
                    "94589.45",
                    "94827.92",
                    "94472.82",
                    "94697.73",
                    "301.884606",
                    "28581396.29069906",
                ],
                [
                    "1735331400000",
                    "94557.99",
                    "94724.86",
                    "94341.8",
                    "94589.45",
                    "520.213925",
                    "49186995.751881",
                ],
                [
                    "1735329600000",
                    "94748.06",
                    "94771.95",
                    "94310",
                    "94557.99",
                    "455.957481",
                    "43095105.41209353",
                ],
                [
                    "1735327800000",
                    "94330.19",
                    "94796.89",
                    "94244.58",
                    "94748.06",
                    "401.934971",
                    "38005242.11633314",
                ],
                [
                    "1735326000000",
                    "94555.11",
                    "94650.83",
                    "94244.4",
                    "94330.19",
                    "426.613808",
                    "40278090.54007384",
                ],
                [
                    "1735324200000",
                    "94559.94",
                    "94749.96",
                    "94336.4",
                    "94555.11",
                    "507.076743",
                    "47974120.78157628",
                ],
                [
                    "1735322400000",
                    "94276.18",
                    "94662.03",
                    "94201.28",
                    "94559.94",
                    "510.755414",
                    "48227374.20008745",
                ],
                [
                    "1735320600000",
                    "93743.63",
                    "94316.46",
                    "93726.79",
                    "94276.18",
                    "590.837022",
                    "55582406.15733882",
                ],
                [
                    "1735318800000",
                    "94164.41",
                    "94351.04",
                    "93481.23",
                    "93743.63",
                    "757.620258",
                    "71157804.31546057",
                ],
                [
                    "1735317000000",
                    "94657.18",
                    "95000",
                    "94087.05",
                    "94164.41",
                    "437.54248",
                    "41360777.14378733",
                ],
            ],
        },
        "retExtInfo": {},
        "time": 1735435969006,
    }
    update = {}

    return args, update


@pytest.fixture
def dataframe(setup_data):
    args, update = setup_data
    # Default values
    return fetch_from_json(args)


def test_detect_fvgs(dataframe):
    """Test detect_fvgs function."""
    fvgs = detect_fvgs(dataframe)
    assert isinstance(fvgs, FVGs), "FVGs should return a FVGs instance."
    assert (
        str(fvgs)
        == """
None."""
    )
